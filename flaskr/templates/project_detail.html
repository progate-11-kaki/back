<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Project Details</title>
</head>
<body>
    <nav>
        <ul>
            <li><a href="{{ url_for('home') }}">Home</a></li>
            {% if current_user.is_authenticated %}
                <li><a href="{{ url_for('profile') }}">Profile</a></li>
            {% endif %}
            <li><a href="{{ url_for('commits', project_id=project.id) }}">View Commits</a></li>
        </ul>
    </nav>
    <div>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul>
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        <h2>Project Detail</h2>
        <p><strong>Project Name:</strong> {{ project.name }}</p>
        <p><strong>Description:</strong> {{ project.description }}</p>
        <p><strong>Tags:</strong> {{ project.tags | join(", ") }}</p>
        <p><strong>作成日時:</strong> {{ project.date_posted.strftime('%Y-%m-%d %H:%M') }}</p>
        
        <!-- 最新のコミットのコミットイメージを表示 -->
        {% if latest_commit and latest_commit.commit_image %}
            <img src="{{ url_for('uploads', filename=latest_commit.commit_image.split('/')[-1]) }}" alt="Commit Image" width="200">
        {% endif %}
        <p>Created by: {{ project.user.username }}</p>
            <p>Members: 
                {% for member in project.members %}
                    {{ member.username }},
                {% endfor %}
            </p>

{% if current_user.id == project.user_id %}
    <a href="{{ url_for('invite_user', project_id=project.id) }}">Invite a member</a>
{% endif %}
        <!-- メンバーのみが編集可能 -->
        {% if current_user.id == project.user_id or current_user in project.members %}
            <li><a href="{{ url_for('commit', project_id=project.id) }}">Add Commit</a></li>
            <p><strong>Status:</strong> {{ "Public" if project.is_public else "Local" }}</p>
            <!-- 公開設定の切り替えフォーム -->
            <form method="post">
                <button type="submit" name="toggle_visibility">
                    {% if project.is_public %}Make Private{% else %}Make Public{% endif %}
                </button>
            </form>
        
            <!-- プロジェクト削除フォーム -->
            <form method="post">
                <button type="submit" name="delete" onclick="return confirm('Are you sure you want to delete this project?');">Delete Project</button>
            </form>
        {% endif %}
    </div>
</body>
</html>